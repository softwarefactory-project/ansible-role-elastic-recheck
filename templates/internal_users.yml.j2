---
_meta:
  type: internalusers
  config_version: 2

# internal_users
{% for user in internal_users %}
{{ user.user }}:
  hash: {{ vars[ user.user + '_hash'] }}
  reserved: true
  backend_roles:
    - "{{ user.role }}"
  description: "Internal user {{ user.user }} for {{ user.role }}"
  hidden: true
{% endfor %}

# NOTE: all roles without kibana (read only user), logstash and
# kibanaserver got admin privileges.
{% for user in users %}
{% if 'role' in user and 'tenant' in user %}
{% if user.role == 'readonly' %}
kibana_{{ user.tenant | replace('.', '_') }}:
  hash: {{ vars['elasticsearch_' + user.user + '_' + (user.tenant | replace('.', '_')) + '_hash'] }}
  reserved: true
  backend_roles:
    - kibana_viewer_{{ user.tenant | replace('.', '_') }}
  description: Kibana viewer user for tenant {{ user.tenant | replace('.', '_') }}
{% else %}
{{ user.user }}_{{ user.tenant | replace('.', '_') }}:
  hash: {{ vars['elasticsearch_' + user.user + '_' + (user.tenant | replace('.', '_')) + '_hash'] }}
  reserved: true
  backend_roles:
    - "{{ user.role }}_{{ user.tenant | replace('.', '_') }}"
  description: "User {{ user.user }} user for {{ user.role }}"
  hidden: true
{% endif %}
{% endif %}
{% endfor %}
